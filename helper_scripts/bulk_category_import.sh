#!/usr/bin/env bash
#
#  seed_categories.sh
#  ------------------
#  Bulk-insert / update 19 canonical categories into MediaCMS.
#
#  Usage
#    ./seed_categories.sh                 # container é è¨­ mediacms-web-1
#    ./seed_categories.sh my_container    # æŒ‡å®š container
#

# â”€â”€â”€ CLI åƒæ•¸ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
CONTAINER=${1:-mediacms-web-1}   # Docker container name / ID
# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

docker exec -i "$CONTAINER" bash <<'EOF'
set -e

python manage.py shell <<'PY'
from django.db import transaction

# å›ºå®šè·¯å¾‘ï¼šfiles.models.Category
from files.models import Category

CATEGORIES = [
    ("å¾Œç«¯æ¶æ§‹",  "èšç„¦é›²ç«¯å¾®æœå‹™ã€Djangoã€Redis èˆ‡å®¹å™¨åŒ–éƒ¨ç½²ã€‚æ·±å…¥ç³»çµ±è¨­è¨ˆèˆ‡æ•ˆèƒ½èª¿æ ¡ï¼Œæ‰“é€ å¯æ°´å¹³æ“´å……çš„å¾Œç«¯ã€‚"),
    ("å‰ç«¯é«”é©—",  "Angularã€Chart.jsã€RxJS èˆ‡ UI/UX ç¯„ä¾‹å…¨æ”¶éŒ„ã€‚ä»‹é¢ç¾è§€ä¸”é«˜äº’å‹•ã€‚"),
    ("ç¨‹å¼èªè¨€",  "Pythonã€TypeScript ç­‰èªæ³•èˆ‡è¨­è¨ˆæ¨¡å¼ï¼Œå¼·åŒ–è·¨èªè¨€æ€ç¶­ã€‚"),
    ("è³‡æ–™èˆ‡ AI", "è³‡æ–™ç®¡ç·šã€çˆ¬èŸ²åˆ°ç”Ÿæˆå¼ AIï¼›åˆ†æã€å»ºæ¨¡ã€MLOps ä¸€æ‡‰ä¿±å…¨ã€‚"),
    ("é›²ç«¯é‹ç¶­",  "CI/CDã€IaCã€SRE èˆ‡ FinOps å¯¦æˆ°ï¼›é›²ç«¯æŒçºŒäº¤ä»˜ä¸¦ç©©å®šç›£æ§ã€‚"),
    ("æ¸¬è©¦å“è³ª",  "Pytestã€E2Eã€è‡ªå‹•åŒ–æ¸¬è©¦æ¡†æ¶ï¼›æ¨å‹• TDD/BDDï¼Œå¯«å‡ºé«˜å“è³ªç¨‹å¼ã€‚"),
    ("è³‡è¨Šå®‰å…¨",  "OAuth 2.0ã€TLSã€é›¶ä¿¡ä»»èˆ‡æ”»é˜²å¯¦æˆ°ï¼›å®ˆè­·ç¨‹å¼ç¢¼èˆ‡è³‡æ–™å®‰å…¨ã€‚"),
    ("æ¼”ç®—æ³•æ•ˆèƒ½", "å¾ Bee Colony Optimization åˆ° Rate-Limitingï¼›å„ªåŒ–è³‡æºã€æå‡ååé‡ã€‚"),
    ("ç”¢å“æ€ç¶­",  "Revenue Funnelã€Scenario è¨­è¨ˆã€ç”¨æˆ¶æ—…ç¨‹ï¼›éŠœæ¥æŠ€è¡“èˆ‡å•†æ¥­ã€‚"),
    ("æ•ˆç‡å·¥å…·",  "Google Calendar ç¥•æŠ€ã€Copilotã€DevToolsâ€¦ å·¥ä½œæµåŠ é€Ÿå™¨ã€‚"),
    ("é ˜å°ç®¡ç†",  "åœ˜éšŠé ˜å°ã€å°ˆæ¡ˆæ²»ç†èˆ‡ç¸¾æ•ˆç®¡ç†ï¼›æ‰“é€ æ•™ç·´å¼é ˜å°åŠ›ã€‚"),
    ("èªªè©±æºé€š",  "ChatGPT å°è©±ã€ç°¡å ±èˆ‡è«‡åˆ¤æŠ€å·§ï¼›æŠŠè¤‡é›œæ¦‚å¿µè¬›åˆ°äººäººéƒ½æ‡‚ã€‚"),
    ("è·æ¶¯æŠ€èƒ½",  "é¢è©¦æŠ€å·§ã€ç¸¾æ•ˆè©•ç­‰èˆ‡æŠ€èƒ½è—åœ–ï¼›æ‰“é€ é•·æœŸè·æ¶¯è­·åŸæ²³ã€‚"),
    ("è²¡å‹™æ™ºæ…§",  "äººç”Ÿè³‡ç”¢é…ç½®ã€ç¨…å‹™å„ªåŒ–ã€ESG æŠ•è³‡ï¼›è·æ¶¯èˆ‡è²¡å¯Œä¸¦é€²ã€‚"),
    ("å¿ƒç†äººéš›",  "å››è‰²äººæ ¼ã€æœƒè­°æ•ˆç‡ã€å”ä½œå¿ƒç†å­¸ï¼›è§£é–åœ˜éšŠå‹•åŠ›ã€‚"),
    ("éŠ·å”®æ¨å»£",  "éŠ·å”®æµç¨‹ã€ææ¡ˆç­–ç•¥èˆ‡å®¢æˆ¶ç¶“ç‡Ÿï¼›ç²¾æº–å‚³éç”¢å“åƒ¹å€¼ã€‚"),
    ("å¸‚å ´å‹•æ…‹",  "ç”¢æ¥­è¶¨å‹¢ã€ç«¶å“åˆ†æèˆ‡æ¨¡å¼æ¼”é€²ï¼›æ´æ‚‰å¸‚å ´æ–°æ©Ÿæœƒã€‚"),
    ("èˆˆè¶£åˆ†äº«",  "æ‰‹ä½œã€æ—…éŠã€æ”å½±ç­‰è·¨ç•Œäº¤æµï¼›æ¿€ç™¼å‰µæ„ç«èŠ±ã€‚"),
    ("é‹å‹•å¥åº·",  "å·¥ä½œä¼¸å±•ã€å±…å®¶é›éŠèˆ‡äººé«”å·¥å­¸ï¼›å®ˆè­·é–‹ç™¼è€…èº«å¿ƒã€‚"),
]

total = len(CATEGORIES)
created = updated = 0

with transaction.atomic():
    for idx, (title, description) in enumerate(CATEGORIES, start=1):
        obj, is_created = Category.objects.update_or_create(
            title=title,
            defaults=dict(description=description, is_global=True),
        )
        action = "ğŸ†•  Created" if is_created else "âœï¸    Updated"
        print(f"{idx:02d}/{total} {action} Â«{title}Â»")
        if is_created:
            created += 1
        else:
            updated += 1

print(f"\nâœ…  Category seeding finished â†’ created={created}, updated={updated}")
PY
EOF
